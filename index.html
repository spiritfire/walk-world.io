<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¥èº«æ¼«æ­¥ V4 - çœŸå®æ¨¡æ‹Ÿç‰ˆ</title>
    <style>
        /* --- 1. åŸºç¡€å¸ƒå±€ --- */
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: #000; overflow: hidden;
            font-family: "DIN Alternate", "Roboto Condensed", sans-serif;
            color: white; user-select: none; -webkit-tap-highlight-color: transparent;
        }

        /* è§†é¢‘å®¹å™¨ */
        #video-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; overflow: hidden;
            display: flex; align-items: center; justify-content: center;
        }
        video {
            /* åˆå§‹çŠ¶æ€ï¼Œä¼šè¢«JSåŠ¨æ€è°ƒæ•´ */
            width: 100%; height: 100%; object-fit: cover;
            transition: transform 0.1s ease-out; /* VRå¹³æ»‘ */
        }

        /* --- 2. æ²‰æµ¸å¼ HUD --- */
        #hud-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; pointer-events: none; /* ç‚¹å‡»ç©¿é€ */
            display: flex; flex-direction: column; justify-content: space-between;
            background: linear-gradient(180deg, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0) 20%, rgba(0,0,0,0) 80%, rgba(0,0,0,0.8) 100%);
        }

        /* é¡¶éƒ¨ä»ªè¡¨ç›˜ */
        .top-dash {
            padding: 20px; display: flex; justify-content: space-between; align-items: flex-start;
        }
        .metric-box { text-align: center; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
        .metric-label { font-size: 12px; color: #aaa; text-transform: uppercase; letter-spacing: 1px; }
        .metric-val { font-size: 38px; font-weight: bold; color: #fff; line-height: 1; }
        .metric-unit { font-size: 14px; color: #00e676; font-weight: bold; }
        
        /* æ­¥æ•°ä¸åé¦ˆç¯ */
        .step-indicator {
            width: 15px; height: 15px; border-radius: 50%; background: #333; 
            border: 2px solid #555; display: inline-block; margin-bottom: 5px;
            transition: background 0.05s, transform 0.1s;
        }
        .step-active { background: #00e676; transform: scale(1.2); box-shadow: 0 0 10px #00e676; border-color: #fff; }

        /* åº•éƒ¨æ§åˆ¶åŒº */
        .bottom-dash {
            padding: 20px; pointer-events: auto;
        }

        /* è¿›åº¦æ¡ç»„åˆ */
        .progress-info { display: flex; justify-content: space-between; font-size: 12px; color: #ccc; margin-bottom: 5px; }
        .progress-track {
            width: 100%; height: 8px; background: rgba(255,255,255,0.2);
            border-radius: 4px; overflow: hidden; margin-bottom: 15px;
        }
        .progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #00e676, #00c853); transition: width 0.5s linear; }

        .btn-toggle {
            background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2);
            color: white; padding: 10px 20px; border-radius: 20px;
            backdrop-filter: blur(5px); font-size: 14px; width: 100%;
        }

        /* --- 3. è®¾ç½®é¢æ¿ (Modal) --- */
        #settings-modal {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: #1e1e1e; border-top: 1px solid #333;
            border-top-left-radius: 20px; border-top-right-radius: 20px;
            padding: 25px; box-sizing: border-box;
            transform: translateY(110%); transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            z-index: 100; pointer-events: auto; color: #eee;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }
        #settings-modal.active { transform: translateY(0); }

        .setting-group { margin-bottom: 20px; }
        .setting-header { display: flex; justify-content: space-between; font-size: 14px; color: #888; margin-bottom: 8px; }
        .setting-val { color: #00e676; font-weight: bold; }
        
        input[type=range] { width: 100%; -webkit-appearance: none; background: #333; height: 6px; border-radius: 3px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; background: #fff; border-radius: 50%; box-shadow: 0 0 5px rgba(0,0,0,0.5); }

        .switch-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-size: 16px; }
        .toggle-switch {
            width: 50px; height: 26px; background: #444; border-radius: 13px; position: relative; transition: 0.3s; cursor: pointer;
        }
        .toggle-switch::after {
            content: ''; position: absolute; top: 3px; left: 3px; width: 20px; height: 20px;
            background: white; border-radius: 50%; transition: 0.3s;
        }
        .toggle-active { background: #00e676; }
        .toggle-active::after { left: 27px; }

        /* --- 4. å¯åŠ¨é¡µ --- */
        #start-overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: #000; z-index: 200;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .hero-btn {
            background: #00e676; color: #000; border: none; padding: 15px 40px;
            border-radius: 50px; font-size: 18px; font-weight: 900; margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 230, 118, 0.4);
        }
        .hero-btn:disabled { background: #333; color: #666; box-shadow: none; }

    </style>
</head>
<body>

    <!-- å¯åŠ¨é¡µ -->
    <div id="start-overlay">
        <h1 style="font-size: 28px; margin-bottom: 10px;">ğŸƒâ€â™‚ï¸ æ¼«æ­¥ V4</h1>
        <p style="color:#666; font-size:13px; margin-bottom: 30px;">çœŸå®æ­¥é¢‘ç®—æ³• Â· è¾¹ç•Œé”å®šVR Â· è§¦æ„Ÿåé¦ˆ</p>
        
        <input type="file" id="fileIn" accept="video/*" style="display:none" onchange="loadFile(this)">
        <button class="hero-btn" style="background:#333; color:#fff" onclick="document.getElementById('fileIn').click()">1. é€‰æ‹©è·¯çº¿è§†é¢‘</button>
        <div id="file-name" style="color:#00e676; font-size:12px; margin: 10px 0; height:15px;"></div>
        
        <button id="start-btn" class="hero-btn" onclick="startApp()" disabled>2. å¼€å§‹æ¢ç´¢</button>
    </div>

    <!-- è§†é¢‘å±‚ -->
    <div id="video-container">
        <video id="mainVideo" playsinline loop muted webkit-playsinline></video>
    </div>

    <!-- HUD å±‚ -->
    <div id="hud-layer" style="display:none;">
        <div class="top-dash">
            <div class="metric-box" style="text-align: left;">
                <div class="metric-label">å½“å‰é€Ÿåº¦</div>
                <div class="metric-val" id="disp-speed">0.0</div>
                <div class="metric-unit">KM/H</div>
            </div>
            
            <div class="metric-box">
                <div class="step-indicator" id="step-led"></div>
                <div class="metric-label">æ­¥é¢‘ SPM</div>
                <div class="metric-val" id="disp-spm">0</div>
            </div>

            <div class="metric-box" style="text-align: right;">
                <div class="metric-label">å‰©ä½™è·ç¦»</div>
                <div class="metric-val" id="disp-dist">0.0</div>
                <div class="metric-unit">KM</div>
            </div>
        </div>

        <div class="bottom-dash">
            <div class="progress-info">
                <span id="time-curr">00:00</span>
                <span id="time-total">00:00</span>
            </div>
            <div class="progress-track">
                <div class="progress-fill" id="prog-fill"></div>
            </div>
            <button class="btn-toggle" onclick="toggleSettings()">âš™ï¸ è¿åŠ¨è®¾ç½® & åé¦ˆ</button>
        </div>
    </div>

    <!-- è®¾ç½®é¢æ¿ -->
    <div id="settings-modal">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <h3 style="margin:0">è®¾ç½®</h3>
            <span onclick="toggleSettings()" style="color:#888; font-size:20px;">âœ•</span>
        </div>

        <!-- 1. é€Ÿåº¦é€»è¾‘ä¿®æ­£ -->
        <div class="setting-group">
            <div class="setting-header">
                åŸè§†é¢‘å½•åˆ¶é€Ÿåº¦ <span class="setting-val" id="val-base">5 km/h</span>
            </div>
            <input type="range" min="2" max="30" value="5" oninput="updateParam('baseSpeed', this.value); calcDistance();">
            <div style="font-size:10px; color:#555; margin-top:5px;">é‡è¦ï¼šæ­¤æ•°å€¼å†³å®šæ€»è·¯ç¨‹çš„è®¡ç®—ã€‚</div>
        </div>

        <div class="setting-group">
            <div class="setting-header">
                å¼ºåº¦å€ç‡ (æ­¥é¢‘ x æ­¥é•¿ x å€ç‡) <span class="setting-val" id="val-mult">1.0x</span>
            </div>
            <input type="range" min="0.5" max="2.0" step="0.1" value="1.0" oninput="updateParam('speedMult', this.value)">
        </div>

        <div class="setting-group">
            <div class="setting-header">
                ä¼ æ„Ÿå™¨çµæ•åº¦ (æ•°å€¼è¶Šå°è¶Šçµæ•) <span class="setting-val" id="val-sens">2.0</span>
            </div>
            <input type="range" min="0.5" max="6.0" step="0.1" value="2.0" oninput="updateParam('sensitivity', this.value)">
        </div>

        <!-- 2. åé¦ˆå¼€å…³ -->
        <div class="switch-row" onclick="toggleSwitch('sound')">
            <span>ğŸ”Š è¸æ­¥éŸ³æ•ˆ (å’šå’šå£°)</span>
            <div class="toggle-switch" id="sw-sound"></div>
        </div>
        <div class="switch-row" onclick="toggleSwitch('vibrate')">
            <span>ğŸ“³ éœ‡åŠ¨åé¦ˆ</span>
            <div class="toggle-switch" id="sw-vibrate"></div>
        </div>

        <div style="text-align:center; font-size:10px; color:#444; margin-top:20px;">
            Tip: åŸåœ°è¸æ­¥è¯·å°†æ‰‹æœºæ”¾å…¥è£¤å…œæˆ–æ¡åœ¨æ‰‹ä¸­
        </div>
    </div>

    <script>
        // --- æ ¸å¿ƒçŠ¶æ€ ---
        const state = {
            baseSpeed: 5,   // è§†é¢‘åŸé€Ÿ km/h
            speedMult: 1.0, // å¼ºåº¦å€ç‡
            sensitivity: 2.0, // é˜ˆå€¼
            stepLength: 0.7, // å‡è®¾æ¯æ­¥ 0.7ç±³
            soundEnabled: false,
            vibrateEnabled: false,
            
            // è¿è¡Œæ—¶
            isPlaying: false,
            totalDistanceKm: 0,
            currentSpeed: 0,
            cadence: 0,     // æ­¥é¢‘
            lastStepTimes: [], // è®°å½•æœ€è¿‘å‡ æ­¥çš„æ—¶é—´æˆ³
            vrMaxOffset: 0, // VRæœ€å¤§åç§»é‡
        };

        const dom = {
            video: document.getElementById('mainVideo'),
            led: document.getElementById('step-led'),
            speed: document.getElementById('disp-speed'),
            spm: document.getElementById('disp-spm'),
            dist: document.getElementById('disp-dist'),
            bar: document.getElementById('prog-fill'),
            settings: document.getElementById('settings-modal')
        };

        // Web Audio Context
        let audioCtx;

        // --- 1. åˆå§‹åŒ– ---
        function loadFile(input) {
            const file = input.files[0];
            if(!file) return;
            dom.video.src = URL.createObjectURL(file);
            document.getElementById('file-name').innerText = file.name;
            document.getElementById('start-btn').disabled = false;
            document.getElementById('start-btn').style.background = "#00e676";

            // è§†é¢‘å…ƒæ•°æ®åŠ è½½åï¼Œè®¡ç®—VRè¾¹ç•Œå’Œæ€»è·¯ç¨‹
            dom.video.onloadedmetadata = () => {
                calcDistance();
                setupVR();
            };
        }

        function startApp() {
            // åˆå§‹åŒ–éŸ³é¢‘ç¯å¢ƒ (å¿…é¡»åœ¨ç”¨æˆ·äº¤äº’ä¸­)
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            
            // å…¨å±
            if(document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
            
            document.getElementById('start-overlay').style.display = 'none';
            document.getElementById('hud-layer').style.display = 'flex';
            
            // é¢„å¤‡æ’­æ”¾
            dom.video.play().then(() => {
                dom.video.playbackRate = 0; // åˆå§‹é™æ­¢
            }).catch(console.error);

            initSensors();
            requestAnimationFrame(loop);
        }

        // --- 2. ç‰©ç†ä¸é€Ÿåº¦è®¡ç®— (æ ¸å¿ƒé‡å†™) ---
        function recordStep() {
            const now = Date.now();
            
            // è¿‡æ»¤æçŸ­æ—¶é—´çš„è¯¯è§¦ (250ms = æœ€å¿«240æ­¥/åˆ†ï¼Œå‡ ä¹æ˜¯äººç±»æé™)
            if (state.lastStepTimes.length > 0) {
                if (now - state.lastStepTimes[state.lastStepTimes.length-1] < 250) return;
            }

            // è®°å½•æ—¶é—´æˆ³
            state.lastStepTimes.push(now);
            // åªä¿ç•™æœ€è¿‘5æ­¥ç”¨äºè®¡ç®—å¹³å‡å€¼ï¼Œä¿è¯å¹³æ»‘
            if (state.lastStepTimes.length > 6) state.lastStepTimes.shift();

            // åé¦ˆ
            triggerFeedback();
        }

        function calculatePhysics() {
            const now = Date.now();
            
            // æ¸…ç†è¶…æ—¶æ­¥æ•° (å¦‚æœè¶…è¿‡2ç§’æ²¡èµ°ï¼Œå°±è®¤ä¸ºåœäº†)
            state.lastStepTimes = state.lastStepTimes.filter(t => now - t < 2500);

            if (state.lastStepTimes.length < 2) {
                state.cadence = 0;
                state.currentSpeed = 0;
            } else {
                // è®¡ç®—å¹³å‡é—´éš”
                let totalInterval = 0;
                for (let i = 1; i < state.lastStepTimes.length; i++) {
                    totalInterval += (state.lastStepTimes[i] - state.lastStepTimes[i-1]);
                }
                const avgInterval = totalInterval / (state.lastStepTimes.length - 1);
                
                // æ­¥é¢‘ (æ­¥/åˆ†)
                state.cadence = Math.round(60000 / avgInterval);

                // é€Ÿåº¦ (km/h) = æ­¥é¢‘/60 * æ­¥é•¿(m) * 3.6(m/s->km/h) * å€ç‡
                // ç®€åŒ–å…¬å¼ï¼šCadence * StepLength * 0.06 * Mult
                const rawSpeed = state.cadence * state.stepLength * 0.06 * state.speedMult;
                
                // å¹³æ»‘å¤„ç†é€Ÿåº¦
                state.currentSpeed += (rawSpeed - state.currentSpeed) * 0.1; 
            }
            
            // åªæœ‰æå°çš„é€Ÿåº¦å°±å½’é›¶
            if (state.currentSpeed < 0.1) state.currentSpeed = 0;
        }

        // --- 3. ä¼ æ„Ÿå™¨é€»è¾‘ ---
        function initSensors() {
            if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission().then(res => {
                    if (res === 'granted') bindSensors();
                });
            } else {
                bindSensors();
            }
        }

        function bindSensors() {
            window.addEventListener('devicemotion', e => {
                const acc = e.accelerationIncludingGravity;
                if(!acc) return;
                // å»é‡åŠ›æ¨¡é•¿
                const total = Math.sqrt(acc.x**2 + acc.y**2 + acc.z**2);
                const delta = Math.abs(total - 9.8);
                
                if (delta > state.sensitivity) {
                    recordStep();
                }
            });

            // VR é€»è¾‘
            window.addEventListener('deviceorientation', handleVR);
        }

        // --- 4. VR é€»è¾‘ä¿®å¤ (åå‘ + è¾¹ç•Œ) ---
        let baseAlpha = null;
        
        function setupVR() {
            const vW = dom.video.videoWidth;
            const vH = dom.video.videoHeight;
            const sW = window.innerWidth;
            const sH = window.innerHeight;
            
            // åˆ¤æ–­æ˜¯å¦æ˜¯æ¨ªå±è§†é¢‘
            const isVideoLandscape = vW > vH;
            
            if (isVideoLandscape) {
                // å¼ºåˆ¶é«˜åº¦å¡«æ»¡ï¼Œè®¡ç®—å®½åº¦æº¢å‡ºå¤šå°‘
                // è§†é¢‘æ¸²æŸ“é«˜åº¦ = å±å¹•é«˜åº¦
                // è§†é¢‘æ¸²æŸ“å®½åº¦ = å±å¹•é«˜åº¦ * (vW / vH)
                const renderW = sH * (vW / vH);
                const overflowPx = renderW - sW;
                
                if (overflowPx > 0) {
                    // å…è®¸å·¦å³å„ç§»åŠ¨ä¸€åŠçš„æº¢å‡ºé‡
                    // è½¬æ¢ä¸ºç›¸å¯¹äºå®½åº¦çš„ç™¾åˆ†æ¯”
                    // maxTranslate% = (overflowPx / 2) / renderW * 100
                    state.vrMaxOffset = (overflowPx / 2) / renderW * 100;
                    
                    dom.video.style.height = "100vh";
                    dom.video.style.width = "auto";
                    dom.video.style.maxWidth = "none"; 
                } else {
                    state.vrMaxOffset = 0; // å±å¹•æ¯”è§†é¢‘è¿˜å®½ï¼Œä¸ç§»åŠ¨
                    dom.video.style.width = "100%";
                    dom.video.style.height = "100%";
                }
            } else {
                 // ç«–å±è§†é¢‘ï¼Œä¸ç§»åŠ¨
                 state.vrMaxOffset = 0;
                 dom.video.style.width = "100%";
                 dom.video.style.height = "100%";
            }
        }

        function handleVR(e) {
            if (state.vrMaxOffset <= 0 || !e.alpha) return;
            
            if (baseAlpha === null) baseAlpha = e.alpha;

            let delta = e.alpha - baseAlpha;
            if (delta > 180) delta -= 360;
            if (delta < -180) delta += 360;

            // ä¿®æ­£æ–¹å‘ï¼šæ‰‹æœºå‘å·¦è½¬(deltaæ­£è´Ÿå–å†³äºOS)ï¼Œä¸€èˆ¬éœ€è¦åå‘ç§»åŠ¨ç”»é¢
            // å‡è®¾å‘å·¦è½¬ delta æ˜¯æ­£æ•°ï¼Œç”»é¢åº”è¯¥å‘å³ç§»(translateX > 0)æ¥çœ‹å·¦è¾¹çš„æ™¯ï¼Ÿ
            // å®é™…ä¸Šï¼šå‘å·¦è½¬å¤´ï¼Œè§†çº¿å‘å·¦ï¼Œç”»é¢åº”è¯¥å‘å³å¹³ç§»ï¼ˆæŠŠå·¦è¾¹çš„å†…å®¹éœ²å‡ºæ¥ï¼‰ã€‚
            
            // é™åˆ¶è§’åº¦èŒƒå›´ (-60åº¦ åˆ° 60åº¦)
            let clampDelta = Math.max(-60, Math.min(60, delta));
            
            // æ˜ å°„åˆ°ç™¾åˆ†æ¯” (-60 ~ 60) -> (-max ~ max)
            // æ¯”ä¾‹ = clampDelta / 60
            const xPercent = (clampDelta / 60) * state.vrMaxOffset;
            
            // åº”ç”¨ (æ³¨æ„æ­£è´Ÿå·è°ƒè¯•ï¼ŒAndroidé€šå¸¸ å·¦è½¬alphaå¢åŠ )
            dom.video.style.transform = `translateX(${xPercent}%)`;
        }


        // --- 5. æ¸¸æˆåŒ–åé¦ˆ ---
        function triggerFeedback() {
            // 1. LED é—ªçƒ
            dom.led.classList.add('step-active');
            setTimeout(() => dom.led.classList.remove('step-active'), 100);

            // 2. éœ‡åŠ¨
            if (state.vibrateEnabled && navigator.vibrate) {
                navigator.vibrate(40); // è½»éœ‡
            }

            // 3. å£°éŸ³ (åˆæˆä½é¢‘è„šæ­¥å£°)
            if (state.soundEnabled && audioCtx) {
                playFootstepSound();
            }
        }

        function playFootstepSound() {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const filter = audioCtx.createBiquadFilter();

            // åˆ¶é€ å™ªéŸ³çš„ä¸€èˆ¬æ–¹æ³•æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œç”¨ç®€å•çš„ä½é¢‘æ­£å¼¦æ³¢æ¨¡æ‹Ÿâ€œå’šâ€
            osc.type = 'triangle'; 
            osc.frequency.setValueAtTime(80, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 0.1);

            filter.type = 'lowpass';
            filter.frequency.value = 200;

            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);

            osc.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);

            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        // --- 6. ä¸»å¾ªç¯ ---
        function loop() {
            calculatePhysics();
            
            // æ›´æ–° UI
            dom.speed.innerText = state.currentSpeed.toFixed(1);
            dom.spm.innerText = state.cadence;
            
            // è®¡ç®—å‰©ä½™è·ç¦»
            // æ€»è·¯ç¨‹å·²ç»åœ¨ calcDistance ç®—å¥½
            // å‰©ä½™ = æ€» * (1 - progress)
            if (dom.video.duration) {
                const pct = dom.video.currentTime / dom.video.duration;
                const remain = state.totalDistanceKm * (1 - pct);
                dom.dist.innerText = remain.toFixed(2);
                dom.bar.style.width = (pct * 100) + "%";
                
                // æ—¶é—´æ˜¾ç¤º
                dom.video.currentTime
                document.getElementById('time-curr').innerText = fmtTime(dom.video.currentTime);
                document.getElementById('time-total').innerText = fmtTime(dom.video.duration);
            }

            // æ§åˆ¶è§†é¢‘
            const rate = state.currentSpeed / state.baseSpeed;
            if (rate > 0.05) {
                dom.video.playbackRate = rate;
                if (dom.video.paused) dom.video.play();
            } else {
                if (!dom.video.paused) dom.video.pause();
            }

            requestAnimationFrame(loop);
        }

        // --- è¾…åŠ©åŠŸèƒ½ ---
        function calcDistance() {
            if (dom.video.duration) {
                // æ—¶é•¿(å°æ—¶) * é€Ÿåº¦(km/h)
                state.totalDistanceKm = (dom.video.duration / 3600) * state.baseSpeed;
            }
        }
        
        function fmtTime(s) {
            const m = Math.floor(s / 60);
            const sec = Math.floor(s % 60);
            return `${m}:${sec < 10 ? '0'+sec : sec}`;
        }

        function toggleSettings() {
            dom.settings.classList.toggle('active');
        }

        function updateParam(key, val) {
            state[key] = parseFloat(val);
            // æ›´æ–°UIæ˜¾ç¤º
            if(key === 'baseSpeed') document.getElementById('val-base').innerText = val + " km/h";
            if(key === 'speedMult') document.getElementById('val-mult').innerText = val + "x";
            if(key === 'sensitivity') document.getElementById('val-sens').innerText = val;
        }

        function toggleSwitch(key) {
            const el = document.getElementById('sw-' + key);
            state[key + 'Enabled'] = !state[key + 'Enabled'];
            if(state[key + 'Enabled']) el.classList.add('toggle-active');
            else el.classList.remove('toggle-active');
            
            // è¯•å¬/è¯•éœ‡
            if(state[key + 'Enabled']) triggerFeedback();
        }
        
        // çª—å£å¤§å°æ”¹å˜é‡æ–°è®¡ç®—VRè¾¹ç•Œ
        window.addEventListener('resize', setupVR);

    </script>
</body>
</html>
